<!DOCTYPE html>
<html lang="zh_cn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>打砖块</title>
  <style lang="text/css">
    #BlockBreaker{
      border: 1px solid #333;
    }
  </style>
  <script src="js/game.js"></script>
  <script src="js/ball.js"></script>
  <script src="js/paddle.js"></script>
  <script src="js/block.js"></script>
</head>
<body>
  <canvas id="BlockBreaker" width="600" height="400"></canvas>
  <script>
    var log = console.log.bind(console)

    // 根据路劲加载图片
    var loadImageByPath = function (path) {
      var img = new Image()
      img.src = path
      return img
    }
    // 碰撞检测
    var rectIntersect = function (a, b) {
      if (a.x > b.x + b.imageW || b.x > a.x + a.imageW || a.y > b.y + b.imageH || b.y > a.y + a.imageH) {
        return false
      } else {
        return true
      }
    }

    var __main = function () {
      var game = XiGame()
      var paddle = Paddle()
      var ball = Ball()


      // 一组砖块
      var blocks = new Array(10)
      for (var i = 0; i < blocks.length; i++) {
          blocks[i] = Block()
          blocks[i].x = blocks[i].imageW * i
          blocks[i].y = 0
      }

      // 注册按键事件
      game.registerAction('a', function () {
        paddle.moveLeft()
      })
      game.registerAction('d', function () {
        paddle.moveRight(game.canvas)
      })
      game.registerAction('f', function () {
        ball.fire()
      })

      game.update = function () {
        ball.move(game.canvas)

        // 球与板子相撞反弹
        if (paddle.collide(ball)) {
          ball.rebound()
        }
        // 球与砖块相撞反弹
        for (var i = 0; i < blocks.length; i++) {
          var block = blocks[i]
          if (block.alive && block.collide(ball)) {
            block.kill()
            ball.rebound()
          }
        }
      }

      game.draw = function () {
        game.drawImage(paddle)
        game.drawImage(ball)
        
        for (var i = 0; i < blocks.length; i++) {
          var block = blocks[i]
          if (block.alive) {
            game.drawImage(block)
          }
        }
      }
    }
    __main()
  </script>
</body>
</html>